## 定点数和浮点数

### 学会提问

1. 现实生活中的整数和小数，这些数字在计算机中是如何存储的？
2. 什么是定点数，定点数有什么作用，是如何存储整数和小数的？有什么问题？
3. 什么是浮点数，为什么会出现，浮点数有什么作用？
4. 为什么会有科学记数法，什么是IEEE标准，为什么要有这个标准？
5. 浮点数为什么会容易丢失精度？
6. java中BigDecimal相关问题：
   1. 如何解决浮点数float丢失精度的，底层实现原理？
   2. 如何比较两个数的大小？
   3. 构造函数为什么推荐传字符串？

---

##### 1.现实生活中的整数和小数，这些数字在计算机中是如何存储的？

​	因为计算机都是二进制存储数据的，所以整数和小数也是二进制存储；

​	这里面会进制转换，比如十进制转换为二进制；

​	其中整数存储，一般使用定点数即可;

​	小于1的小数，也可以使用定点数即可;

​	整数+小数，由于定点数缺失精度比较严重，并且范围也有限，所以采用浮点数进行存储。

##### 2.什么是定点数，定点数有什么作用？是如何存储整数和小数的？有什么问题？

​	根据问题1的解答，可以得出定点数也是二进制数，也是用来存储整数和小数的；

​	定：固定，点：小数点，小数点位置固定。

​	定点数只是表示数字的一种形式，分以下三种情况：

​	纯整数：例如整数100转为二进制，小数点在最后一位，忽略不写

​	纯小数：例如0.123转为二进制，小数点固定在最高位

​	整数+小数：例如1.24，10.234，小数点固定在某个位置

​	**这里具体看定点数如何整数+小数，比如25.125**

​	**前提：需要先约定小数点的位置，以一个字节8bit为例，约定前5位表示整数部分，后三位表示小数部分。**

```java
25十进制转二进制：11001 // 整数部分和小数部分，分别转换为二进制表示
0.125十进制转二进制：00100000 // 整数部分和小数部分，分别转换为二进制表示
25.125（D）= 11001 001(B) // 两部分二进制组合起来，即是结果
```

​	定点数表示小数存在的问题：

```java
我们约定了前 5 位表示整数部分，后 3 位表示小数部分，此时这个整数部分的二进制最大值只能是 11111，即十进制的 31，小数部分的二进制最大只能表示 0.111，即十进制的 0.875。

如果想要表示更大范围的值，如何表示？
1.扩大bit的宽度，例如使用2个字节，4个字节，这样整数部分和小数部分宽度增加，表示范围也就大了；
2.改变小数点的位置，小数点向后移动， 整个数字范围会扩大，但是小数部分的精度就会降低； 
```

​	因此，不管如何约定小数点的位置，都会存在以下问题：

- 数值**表示范围**有限（小数点越靠左，整个数值范围越小）
- 数值**精确范围**有限（小数点越靠右，数值精度越低）

##### 3.什么是浮点数，为什么会出现，浮点数有什么作用？

​	为了解决上面定点数的问题，浮点数就出现了。

​	浮点：小数点的位置是可以漂浮不定的；

​	浮点数就是二进制的科学记数法来表示的；

​	例如十进制的8.345 用科学记数法表示，可以有多种形式：

```java
8.345 = 8.345 * 10^0
8.345 = 83.45 * 10^-1
8.345 = 834.5 * 10^-2
...
```

​	**同理，对于二进制数，也可以使用科学记数法表示，公示如下：**

```java
V = (-1)^S * M * R^E
S: 符号位，取值0或1，决定一个数字的符号，0表示正，1表示负
M: 尾数，用小数表示，例如前面所看到的 8.345 * 10^0，8.345 就是尾数
R: 基数，表示十进制数 R 就是 10，表示二进制数 R 就是 2
E: 指数，用整数表示，例如前面看到的 10^-1，-1 即是指数  
```

​	规则：使用32bit表示一个浮点数，符号位占1bit，指数占10bit，尾数占21bit【自定义规则】

​	按照这个规则，将十进制25.125转换为浮点数，转换过程：

```java
1 整数部分：25 = 11001
2 小数部分：0.125 = 0.001
3 用二进制科学记数法表示：25.125=11001.001=1.1001001 * 2^4
```

​	因为规则是我们自己定义出来，如果不同的厂商都定义自己的浮点数规则，那么同一个数表示出的浮点数是不一样的；

​	**所以业界需要一个统一的浮点数标准。直到1985年，IEEE组织推出了浮点数标准，也就是经常听到的IEEEE754浮点数标准，**

​	**单精度浮点数float：32位，符号位占1bit，指数位占8bit，尾数占23bit；**

​	**双精度浮点数float：64位，符号位占1bit，指数位占11bit，尾数占52bit；**

##### 4.为什么会有科学记数法，什么是IEEE标准，为什么要有这个标准？

​	因为浮点数，小数点位置是不固定的，科学记数法，刚好可以让小数点位置不固定；

​	IEEE标准，就是统一一个规则，让不同的计算机厂商都使用同一个规则来表示一个数，

​	符号位占多少，指数位占多少，尾数占多少

##### 5.浮点数为什么容易丢失精度？

​	平常听到的浮点数会有精度缺失是怎么回事？

​	如果我们现在想用浮点数表示0.2，转换过程如下：

```java
0.2 * 2 = 0.4 -> 0
0.4 * 2 = 0.8 -> 0
0.8 * 2 = 1.6 -> 1
0.6 * 2 = 1.2 -> 1
0.2 * 2 = 0.4 -> 0（发生循环）
...
0.2(D) = 0.00110…(B)
  
0.2转换为二进制数的过程为，不断乘2，直到不存在小数为止，在这个计算过程中，得到的整数部分从上到下排列就是二进制的结果
```

​	因为十进制的 0.2 无法精确转换成二进制小数，而计算机在表示一个数字时，宽度是有限的，无限循环的小数存储在计算机时，只能被截断，所以就会导致小数精度发生损失的情况。

##### 6.java中的BigDecimal相关问题

1.  如何解决浮点数float丢失精度的，底层实现原理？

   不使用二进制，而是使用十进制BigInteger+小数点位置scale来表示小数

   

##### 参考博客：

[定点数](http://kaito-kidd.com/2018/07/23/computer-system-fixed-point/)；

[浮点数](http://kaito-kidd.com/2018/08/08/computer-system-float-point/)；

[使用bigdecimal解决浮点数丢失精度问题](https://blog.csdn.net/weixin_50179223/article/details/118853573?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1.pc_relevant_default&spm=1001.2101.3001.4242.2&utm_relevant_index=4)；

